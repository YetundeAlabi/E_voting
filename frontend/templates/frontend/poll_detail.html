<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <title>Poll Details</title>
</head>
<body>
  <div class="container mt-4">
    <h2>Poll Details</h2>

    <div class="card mt-4">
      <div class="card-body">
        <h5 class="card-title" id="pollName"></h5>
        <p class="card-text" id="pollDescription"></p>
        <p class="card-text"><strong>Start Time:</strong> <span id="startTime"></span></p>
        <p class="card-text"><strong>End Time:</strong> <span id="endTime"></span></p>

        <h5 class="mt-4">Voter Details</h5>
        <p><strong>User ID:</strong> <span id="userId"></span></p>
        <p><strong>Email:</strong> <span id="email"></span></p>
        <p><strong>Full Name:</strong> <span id="fullName"></span></p>
        <p><strong>Phone Number:</strong> <span id="phoneNumber"></span></p>

        <h5 class="mt-4">Candidates</h5>
        <form action="/vote" method="POST">
          {% csrf_token %}
          <div id="candidateOptions"></div>
          <button type="submit" class="btn btn-primary mt-4">Vote</button>
        </form>
      </div>
    </div>
  </div>

  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    // Fetch the poll details from the API
    fetch('/api/poll/1')
      .then(response => response.json())
      .then(data => {
        // Populate the template with the retrieved data
        document.getElementById('pollName').textContent = data.name;
        document.getElementById('pollDescription').textContent = data.description;
        document.getElementById('startTime').textContent = data.start_time;
        document.getElementById('endTime').textContent = data.end_time;
        document.getElementById('userId').textContent = data.voter.user.id;
        document.getElementById('email').textContent = data.voter.user.email;
        document.getElementById('fullName').textContent = data.voter.user.full_name;
        document.getElementById('phoneNumber').textContent = data.voter.user.phone_number;

        // Populate the candidate options
        const candidateOptions = document.getElementById('candidateOptions');
        data.candidates.forEach(candidate => {
          const div = document.createElement('div');
          div.className = 'form-check';
          div.innerHTML = `
            <input class="form-check-input" type="radio" name="candidate" id="candidate${candidate.id}" value="${candidate.name}">
            <label class="form-check-label" for="candidate${candidate.id}">
              ${candidate.name}
            </label>
          `;
          candidateOptions.appendChild(div);
        });
      })
      .catch(error => {
        console.error('Error:', error);
      });
  </script>
</body>
</html>
